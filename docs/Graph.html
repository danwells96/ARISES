<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Graph  Reference</title>
    <link rel="stylesheet" type="text/css" href="css/jazzy.css" />
    <link rel="stylesheet" type="text/css" href="css/highlight.css" />
    <meta charset='utf-8'>
    <script src="js/jquery.min.js" defer></script>
    <script src="js/jazzy.js" defer></script>
    
  </head>
  <body>
    <a name="//apple_ref/swift/Section/Graph" class="dashAnchor"></a>
    <a title="Graph  Reference"></a>
    <header>
      <div class="content-wrapper">
        <p><a href="index.html">ARISES Docs</a> (61% documented)</p>
        <p class="header-right"><a href="https://github.com/danwells96/ARISES"><img src="img/gh.png"/>View on GitHub</a></p>
      </div>
    </header>
    <div class="content-wrapper">
      <p id="breadcrumbs">
        <a href="index.html">ARISES Reference</a>
        <img id="carat" src="img/carat.png" />
        Graph  Reference
      </p>
    </div>
    <div class="content-wrapper">
      <nav class="sidebar">
        <ul class="nav-groups">
          <li class="nav-group-name">
            <a href="Documentation.html">Documentation</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="client-design.html">Client Design</a>
              </li>
              <li class="nav-group-task">
                <a href="final-design.html">Final Design</a>
              </li>
              <li class="nav-group-task">
                <a href="design-process.html">Design Process</a>
              </li>
              <li class="nav-group-task">
                <a href="program-architecture.html">Program Architecture</a>
              </li>
              <li class="nav-group-task">
                <a href="testing.html">Testing</a>
              </li>
              <li class="nav-group-task">
                <a href="future-work.html">Future Work</a>
              </li>
              <li class="nav-group-task">
                <a href="ethics-report.html">Ethics Report</a>
              </li>
              <li class="nav-group-task">
                <a href="sustainability-report.html">Sustainability Report</a>
              </li>
              <li class="nav-group-task">
                <a href="meeting-minutes.html">Meeting Minutes</a>
              </li>
              <li class="nav-group-task">
                <a href="focus-group-report.html">Focus Group Report</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Model.html">Model</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/ModelController.html">ModelController</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/PersistenceService.html">PersistenceService</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Insulin.html">Insulin</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Glucose.html">Glucose</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Day.html">Day</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Favourites.html">Favourites</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Meals.html">Meals</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Exercise.html">Exercise</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Illness.html">Illness</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/Stress.html">Stress</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Graph.html">Graph</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/ViewControllerGraph.html">ViewControllerGraph</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/ChartBGView.html">ChartBGView</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/CustomView.html">CustomView</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/ChartPointEllipseView.html">ChartPointEllipseView</a>
              </li>
              <li class="nav-group-task">
                <a href="Extensions/ChartPointEllipseView.html#/s:6ARISES5extra33_B71D914AD94168EA0A72EED549E247EDLLV">– extra</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Main View.html">Main View</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/ViewControllerMain.html">ViewControllerMain</a>
              </li>
              <li class="nav-group-task">
                <a href="Enums/MainViewState.html">MainViewState</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Food Domain.html">Food Domain</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/ViewControllerFood.html">ViewControllerFood</a>
              </li>
              <li class="nav-group-task">
                <a href="Classes/IndicatorControllerFood.html">IndicatorControllerFood</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Exercise Domain.html">Exercise Domain</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/ViewControllerExercise.html">ViewControllerExercise</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Health Domain.html">Health Domain</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/ViewControllerHealth.html">ViewControllerHealth</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Advice Domain.html">Advice Domain</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/ViewControllerAdvice.html">ViewControllerAdvice</a>
              </li>
            </ul>
          </li>
          <li class="nav-group-name">
            <a href="Tables.html">Tables</a>
            <ul class="nav-group-tasks">
              <li class="nav-group-task">
                <a href="Classes/ViewControllerTableViewCell.html">ViewControllerTableViewCell</a>
              </li>
              <li class="nav-group-task">
                <a href="Protocols/tableCellDelegate.html">tableCellDelegate</a>
              </li>
            </ul>
          </li>
        </ul>
      </nav>
      <article class="main-content">
        <section>
          <section class="section">
            <h1>Graph</h1>
            <h1 id='bifocal-display-breakdown' class='heading'>Bifocal Display Breakdown</h1>

<p align="center">
    <img src="https://raw.githubusercontent.com/danwells96/ARISES/master/DocFiles/img/Bifocal.png" alt="Image of Bifocal"/>
</p>
<h3 id='functionalities' class='heading'>Functionalities</h3>

<ul>
<li><p>The most important infomation gets displayed on the main graph while less relevant data is displayed on the side views. </p></li>
<li><p>Scrolling left and right allows users to change the day&rsquo;s data which is being viewed in more detail.</p></li>
<li><p>The <em>Add Insulin</em> icon on the top right corner allows user to add insulin.</p></li>
<li><p>The <em>Settings</em> icon on the top left allows the user to go to the settings page and make changes to the application.</p></li>
<li><p><em>DatePicker</em> allows user the current date they are visualising. When tapped user can navigate to another day.</p></li>
<li><p>When the graph is currently not on today, tap on <em>DatePicker</em> where the default popup date is set to today and click on that would take the user back to today.</p></li>
<li><p><strong>The main graph:</strong> </p>

<ul>
<li>Shows monitored glucose level on a day (to be taken from patients&rsquo; wearables).</li>
<li>To keep the graph area as clean as possible the time interval displayed on the x axis is set to 6 hours.</li>
<li>Daily meals, execises and insulin dosage are updated on the main graph as soon as they are logged. Users can keep track on what time they did those activities.</li>
<li>Messages of detailed information can be obtained when points are tapped.</li>
<li>A popup message displaying the amount of carbs, protein and fats associated with each meal will appear when you tap on a meal point.</li>
<li>A message for exercise would include exercise&rsquo;s name, duration and intensity.</li>
<li>An insulin message states how many units of insulin were logged and the time administered.</li>
</ul></li>
<li><p><strong>The sideviews:</strong> </p>

<ul>
<li>Shows the range and mean average of blood glucose levels for the user on that particular day.</li>
</ul></li>
</ul>
<h2 id='proof-read-to-here' class='heading'>Proof read to here</h2>
<h2 id='chartbase-setup' class='heading'>ChartBase Setup</h2>

<p>The bifocal display consists of three parts: </p>

<ul>
<li>Leftside view container</li>
<li>Main graph section</li>
<li>Rightside view container</li>
</ul>
<h2 id='left-amp-right-sideview-containers' class='heading'>Left &amp; Right Sideview Containers</h2>

<p>Each of the side view containers has three subviews of type CustomView (UIView) which are customized to show colours bands as a background. </p>
<h4 id='em-chartbgview-swift-em-and-em-customview-swift-em' class='heading'><em>ChartBGView.swift</em> and <em>CustomView.swift</em></h4>

<p>The same colour bands are used on the main chart as well thus <em>ChartBGView.swift</em> follows the same logic as the <em>CustomView.swift</em> in term of filling the background color bands. But <em>CustomView.swift</em> is also used to draw range bars on each sideview using calculated values for glucose values storing in core data on a day.</p>
<h6 id='bands-calculations' class='heading'>Bands calculations</h6>

<p>The bands are calculated based on glucose level. If the total height of the Custom View is considered as an equivalent glucose level of 20 (mM/)L  then a &lsquo;safe&rsquo;[<a href="https://www.niddk.nih.gov/health-information/diabetes/overview/preventing-problems/low-blood-glucose-hypoglycemia">1</a>] range for patients to stay in would be between 4 and 10. Above 10 would be classified as a hyper and below 4 would be seen as a hypo.</p>

<p>Therefore, the top half of chart would be in <strong>high</strong> range, the bottom 4/20 (20%) of chart would be in <strong>low</strong> range and 6/20 (~30%)section in the middle would be of normal. </p>

<p>The high and low bands are coloured differently to draw users attention. Colour palette here is simple and can be modified. (Colour combinations particularly red &amp; green are avoided as diabetes suffering from retinopathy have problems distinguishing between them.)</p>
<h4 id='em-drawmiddleband-em' class='heading'><em>drawMiddleBand()</em></h4>

<ul>
<li><p><strong>Description:</strong>
This function draws a rectangle with orgin (0,0) - top left corner, and extends itself to the reqired height (30% of total height). After it draws/marks, it colours the marked area with selected color.</p></li>
<li><p><strong>Returns:</strong>
This would give the background of image below (without the range bars).</p></li>
</ul>

<p align="center">
    <img src="https://raw.githubusercontent.com/danwells96/ARISES/master/DocFiles/img/sideview.png" alt="Image of sideview"/>
</p>
<h4 id='em-drawrangebar-em' class='heading'><em>drawRangeBar()</em></h4>

<ul>
<li><p><strong>Description:</strong>
This function is created to draw maximun and minimum dashes as well as the average circle on side views. 
It uses UIBezierPath() as a drawing tool. Both line width and stroke colour can be set using this method.</p></li>
<li><p><strong>Parameter:</strong>
It takes no parameters but the output of sorting the glucose array on certain day would gives maximum and minimum. The difference  in heights of maximum &amp; minimum with respect to glucose level of 20(mM/L) would be the stroke length of the range bar.</p></li>
<li><p><strong>Returns:</strong> An UIView with a drawn range bar</p></li>
</ul>

<p>A view it creates would be: </p>

<p align="center">
    <img src="https://raw.githubusercontent.com/danwells96/ARISES/master/DocFiles/img/rangeBar.png" alt="Image of range bar"/>
</p>
<h2 id='main-graph-section' class='heading'>Main graph section</h2>
<h3 id='em-viewcontrollergraph-swift-em' class='heading'><em>ViewControllerGraph.swift</em></h3>

<p>In this section we do everything graph related. For example:</p>

<ul>
<li>Transform sideView containers into bifocal.</li>
<li>Load tmp arrays into Core Data.</li>
<li>Show date picker.<br></li>
<li>Update settings.<br></li>
<li>Update popups and attached messages.</li>
</ul>

<p>Modifications are made on top of an iOS chart library which can be found <a href="https://github.com/i-schuetz/SwiftCharts.git">here</a></p>

<ul>
<li>Layers: xAxisLayer, yAxisLayer, yHighAxes, guidelinesLayer, pointslineLayer, prediction, chartPointsCircleLayer</li>
</ul>

<p><strong>xAxisLayer</strong> conatins x-axis model and x-axis label settings. It displays time in a day with an interval of 6 hours thus 4 dividers.</p>

<p><strong>yAxisLayer</strong> conatins glucose axis model and label settings. The axis ranges from 0 to 20 (mM/L) with an interval of 4. </p>

<p><strong>yHighAxes</strong> contains an invisible carbs axis on the right side of chart. Meals popups are plotted based on carbs axis and shares the same x-axis with glucose points.</p>

<p><strong>guidelinesLayer</strong> provides dotted grid lines on graph</p>

<p><strong>pointslineLayer</strong> draws glucose curve on graph in a solid blue line</p>

<p><strong>prediction</strong> predicts patient&rsquo;s glucose in the next half an hour (now only tested with fixed data points)</p>

<p><strong>chartPointsCircleLayer</strong> is where popups are set up. It has a touchHandler to deal with touch events which is to print a message based on the points being tapped.</p>

<p>The touchHandler detects where the finger tapped on the screen and compares the x-position of the touch with x coordinates of popups it stored. If they match or close to a certain degree the infoBubble is enabled which prints a message to user. If touches happens outside screen frame it returns the edge cases.</p>

          </section>
          <section class="section task-group-section">
            <div class="task-group">
              <ul>
                <li class="item">
                  <div>
                    <code>
                    <a name="/c:@M@ARISES@objc(cs)ViewControllerGraph"></a>
                    <a name="//apple_ref/swift/Class/ViewControllerGraph" class="dashAnchor"></a>
                    <a class="token" href="#/c:@M@ARISES@objc(cs)ViewControllerGraph">ViewControllerGraph</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>The UIViewController subclass for the top half of the app&rsquo;s UI. It controls the bifocal display utilising the SwiftCharts library, referenced in
the documentation.</p>

                        <a href="Classes/ViewControllerGraph.html" class="slightly-smaller">See more</a>
                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">ViewControllerGraph</span> <span class="p">:</span> <span class="kt">UIViewController</span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
                <li class="item">
                  <div>
                    <code>
                    <a name="/"></a>
                    <a name="//apple_ref/swift/Extension/ChartPointEllipseView" class="dashAnchor"></a>
                    <a class="token" href="#/">ChartPointEllipseView</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>Extension to the ChartPointEllipseView class from the SwiftCharts library allowing a string to be associated with an individual 
point on the chart, which gives the method for determining what text should be displayed on the point&rsquo;s popup.</p>

                        <a href="Extensions/ChartPointEllipseView.html" class="slightly-smaller">See more</a>
                      </div>
                    </section>
                  </div>
                </li>
              </ul>
            </div>
            <div class="task-group">
              <ul>
                <li class="item">
                  <div>
                    <code>
                    <a name="/c:@M@ARISES@objc(cs)ChartBGView"></a>
                    <a name="//apple_ref/swift/Class/ChartBGView" class="dashAnchor"></a>
                    <a class="token" href="#/c:@M@ARISES@objc(cs)ChartBGView">ChartBGView</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>This class is a subclass of UIView used to create the three bands of the &lsquo;safe&rsquo; range for the background of the chart using it&rsquo;s 
methods.</p>

                        <a href="Classes/ChartBGView.html" class="slightly-smaller">See more</a>
                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">ChartBGView</span> <span class="p">:</span> <span class="kt">UIView</span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
              </ul>
            </div>
            <div class="task-group">
              <ul>
                <li class="item">
                  <div>
                    <code>
                    <a name="/c:@M@ARISES@objc(cs)CustomView"></a>
                    <a name="//apple_ref/swift/Class/CustomView" class="dashAnchor"></a>
                    <a class="token" href="#/c:@M@ARISES@objc(cs)CustomView">CustomView</a>
                    </code>
                  </div>
                  <div class="height-container">
                    <div class="pointer-container"></div>
                    <section class="section">
                      <div class="pointer"></div>
                      <div class="abstract">
                        <p>The class is a subclass of UIView and is used in the bifocal display as the sideViews. It includes methods to draw the daily glucose
ranges calculated using the member data and to draw the upper band for the background &lsquo;safe&rsquo; range.</p>

                        <a href="Classes/CustomView.html" class="slightly-smaller">See more</a>
                      </div>
                      <div class="declaration">
                        <h4>Declaration</h4>
                        <div class="language">
                          <p class="aside-title">Swift</p>
                          <pre class="highlight swift"><code><span class="kd">class</span> <span class="kt">CustomView</span> <span class="p">:</span> <span class="kt">UIView</span></code></pre>

                        </div>
                      </div>
                    </section>
                  </div>
                </li>
              </ul>
            </div>
          </section>
        </section>
        <section id="footer">
          <p>&copy; 2018 <a class="link" href="" target="_blank" rel="external">Ryan Armiger, Becky Elkington, Xiaoyu Ma, Dan Wells</a>. All rights reserved. (Last updated: 2018-06-21)</p>
          <p>Generated by <a class="link" href="https://github.com/realm/jazzy" target="_blank" rel="external">jazzy ♪♫ v0.9.3</a>, a <a class="link" href="https://realm.io" target="_blank" rel="external">Realm</a> project.</p>
        </section>
      </article>
    </div>
  </body>
</div>
</html>
